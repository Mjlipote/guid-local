<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<title>Paper Trail</title>
<th:block th:include="head :: bootstrap" />
<link rel="stylesheet" href="/simplePagination.css"></link>
<script src="/jquery.simplePagination.js"></script>
<style type="text/css">
</style>
<th:block th:include="top :: navigation" class="container-fluid" />

<script type="text/javascript">
	$(function() {
		var items = $("table tbody tr");
		var numItems = items.length;
		var perPage = 30;
		items.slice(perPage).hide();

		$(pages).pagination({

			items : numItems,
			itemsOnPage : perPage,
			cssStyle : "light-theme",

			onPageClick : function(pageNumber) {

				var showFrom = perPage * (pageNumber - 1);
				var showTo = showFrom + perPage;

				items.hide() // first hide everything, then show for the new page
				.slice(showFrom, showTo).show();
			}
		});
		var checkFragment = function() {
			// if there's no hash, make sure we go to page 1
			var hash = window.location.hash || "#page-1";

			// we'll use regex to check the hash string
			hash = hash.match(/^#page-(\d+)$/);

			if (hash)
				// the selectPage function is described in the documentation
				// we've captured the page number in a regex group: (\d+)
				$(pages).pagination("selectPage", parseInt(hash[1]));
		};

		// we'll call this function whenever the back/forward is pressed
		$(window).bind("popstate", checkFragment);

		// and we'll also call it to check right now!
		checkFragment();
	});
</script>
</head>
<body>
	<div id="wrap">
		<h1 class="text-center">操作記錄追蹤</h1>

		<div id="main">
			<form class="form-inline col-md-8 col-md-offset-2" method="get"
				th:action="@{/trail/lookup}" role="form">
				<div class="row">
					<div class="form-group col-md-3">
						<label class="sr-only">User ID：</label><select
							data-toggle="select"
							class="form-control select select-primary mrs mbm" name="userId">
							<option value="">User ID</option>
							<th:block th:each="userId : ${userIds}">
								<option th:value="${userId}" th:text="${userId}"></option>
							</th:block>
						</select>
					</div>
					<div class="form-group col-md-3">
						<label class="sr-only">Remote Address：</label><select
							data-toggle="select"
							class="form-control select select-primary mrs mbm"
							name="remoteAddr">
							<option value="">Remote Address</option>
							<th:block th:each="remoteAddr : ${remoteAddrs}">
								<option th:value="${remoteAddr}" th:text="${remoteAddr}"></option>
							</th:block>
						</select>
					</div>
					<div class="form-group col-md-3">
						<label class="sr-only">Request URL：</label><select
							data-toggle="select"
							class="form-control select select-primary mrs mbm"
							name="requestUri">
							<option value="">Request URL</option>
							<th:block th:each="requestURI : ${requestURIs}">
								<option th:value="${requestURI}" th:text="${requestURI}"></option>
							</th:block>
						</select>
					</div>
					<div class="form-group col-md-3">
						<label class="sr-only">HTTP Status：</label><select
							data-toggle="select"
							class="form-control select select-primary mrs mbm"
							name="httpStatus">
							<option value="">HTTP Status</option>
							<th:block th:each="httpStatus : ${httpStatuses}">
								<option th:value="${httpStatus}" th:text="${httpStatus}"></option>
							</th:block>
						</select>
					</div>
				</div>


				<div class="row col-md-12">

					<div class="form-group">
						<input class="btn btn-inverse btn-block btn-sm" type="submit"
							value="搜尋操作記錄"></input>
					</div>
				</div>
			</form>

			<div class="container" id="pages"></div>

			<div id="wrap">
				<table
					class="table table-responsive table-bordered table-striped table-condensed table-hover">
					<thead>
						<th:tr>
							<td><strong>#</strong></td>
							<td><strong>User ID</strong></td>
							<td><strong>Remote Address</strong></td>
							<td><strong>HTTP Method</strong></td>
							<td><strong>Request URL</strong></td>
							<td><strong>HTTP Status</strong></td>
							<td><strong>Created At</strong></td>

						</th:tr>
					</thead>
					<tbody>

						<tr th:each="paperTrail : ${paperTrails}">
							<td th:text="${paperTrail.id}"></td>
							<td th:text="${paperTrail.userId}"></td>
							<td th:text="${paperTrail.remoteAddr}"></td>
							<td th:text="${paperTrail.httpMethod}"></td>
							<td th:text="${paperTrail.requestURI}"></td>
							<td th:text="${paperTrail.httpStatus}"></td>
							<td th:text="${paperTrail.createdAt}"></td>
						</tr>
					</tbody>
				</table>

				<div class="container" id="pages"></div>
			</div>
		</div>
	</div>
	<th:block th:include="footer :: footer" class="container-fluid" />
</body>
</html>